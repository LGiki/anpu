---
import { defaultLang, type languages } from "@/i18n/ui";
import { useTranslatedPath } from "@/i18n/utils";
import { Icon } from "astro-icon/components";
import type { CollectionEntry } from "astro:content";
import dayjs from "dayjs";

interface Props {
  concerts: CollectionEntry<"concert">[];
  language?: keyof typeof languages;
}

const props: Props = Astro.props;

const concertsSorted = props.concerts.sort((a, b) => {
  return dayjs(b.data.date).diff(a.data.date);
});

const translatePath = useTranslatedPath(props.language || defaultLang);
---

<div class="flex flex-col">
  {
    concertsSorted.map((concert) => {
      const [_, ...slug] = concert.id.split("/");
      const url = translatePath(`/concert/${slug.join()}`);
      return (
        <a
          href={url}
          class="border-b dark:border-b-zinc-700/90 last:border-b-0 min-h-12 flex items-center justify-between gap-3 sm:gap-5 py-2"
        >
          <div class="flex gap-3 sm:gap-5 items-center text-sm sm:text-base">
            <span class="w-26 text-gray-400 flex-shrink-0 font-mono">
              {dayjs(concert.data.date).format("YYYY-MM-DD")}
            </span>
            <span class="text-[var(--foreground)] text-wrap flex-1">
              {concert.data.tour}
            </span>
          </div>
          {concert.data.location && (
            <>
              <div class="flex items-center gap-1 text-gray-400 flex-shrink-0 text-sm sm:text-base">
                <Icon name="ph:map-pin" />
                <span>{concert.data.place}</span>
              </div>
            </>
          )}
        </a>
      );
    })
  }
</div>
